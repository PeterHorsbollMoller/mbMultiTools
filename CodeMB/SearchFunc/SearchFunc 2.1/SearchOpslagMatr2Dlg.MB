'*******************************************************************************
'** 	Program:	Searching
'** 	Modul:	SearchOpslagDlg	
'**			Dialoger til opslagssøgninger
'*******************************************************************************

Include "MapBasic.def"
Include "Icons.def"
Include "Menu.def"

'-----------------------------------------------------------------------------------------
Include "..\..\Language\Message.lng"
Include "..\..\Language\Errors.lng"

'-----------------------------------------------------------------------------------------
Include "SearchMain.def"
Include "SearchFunc.def"
Include "SearchDlgFunc.def"
Include "SearchOpslagMatr2Dlg.def"

Include "..\..\IniUtil\IniUtil.def"
Include "..\..\ArrayFunc\ArrayFunc.def"
Include "..\..\TabFunc\TabFunc.def"

Define	SRCH_CTRL_MATR_KOMMUNENR_TITLE	101
Define	SRCH_CTRL_MATR_KOMMUNENR_LIST		100
Define	SRCH_CTRL_MATR_KOMMUNENR_VALUE	102
Define	SRCH_CTRL_MATR_KOMMUNENR_BUTTON	103
Define	SRCH_CTRL_MATR_LANDSELAVNR_TITLE	201
Define	SRCH_CTRL_MATR_LANDSELAVNR_LIST	200
Define	SRCH_CTRL_MATR_LANDSELAVNR_VALUE	202
Define	SRCH_CTRL_MATR_LANDSELAVNR_BUTTON	203
Define	SRCH_CTRL_MATR_KOMMELAVNR_TITLE	301
Define	SRCH_CTRL_MATR_KOMMELAVNR_LIST	300
Define	SRCH_CTRL_MATR_KOMMELAVNR_VALUE	302
Define	SRCH_CTRL_MATR_KOMMELAVNR_BUTTON	303
Define	SRCH_CTRL_MATR_LANDSELAV_TITLE	401
Define	SRCH_CTRL_MATR_LANDSELAV_LIST		400
Define	SRCH_CTRL_MATR_LANDSELAV_VALUE	402
Define	SRCH_CTRL_MATR_LANDSELAV_BUTTON	403
Define	SRCH_CTRL_MATR_MATRNR_TITLE		501
Define	SRCH_CTRL_MATR_MATRNR_LIST		500
Define	SRCH_CTRL_MATR_MATRNR_BUTTON		503
Define	SRCH_CTRL_MATR_MATRNR_VALUE		502
Define	SRCH_CTRL_MATR_ZOOM			1000
Define	SRCH_CTRL_MATR_AUTOCLOSE		2000

	'1 KOMNR
	'2 L ELAVNR
	'3 K ELAVNR
	'4 ELAV
	'5 MATR

'------------
Declare Sub HandlerMatr2EnrElavLoad
Declare Sub HandlerMatr2EnrElavList
Declare Sub HandlerMatr2EnrElavButton
Declare Sub Matr2EnrElavListCTRL(ByVal nCtrl As Integer, ByVal bSelectAll As Logical, ByVal bReCalled As Logical)
Declare Sub Matr2EnrElavButtonCTRL(ByVal nCtrl As Integer)

'------------
Declare Sub HandlerMatr2EnrKenrElavLoad
Declare Sub HandlerMatr2EnrKenrElavList
Declare Sub HandlerMatr2EnrKenrElavButton
Declare Sub Matr2EnrKenrElavListCTRL(ByVal nCtrl As Integer, ByVal bSelectAll As Logical, ByVal bReCalled As Logical)
Declare Sub Matr2EnrKenrElavButtonCTRL(ByVal nCtrl As Integer)

'------------
Declare Sub HandlerMatr2KnrEnrKenrElavLoad
Declare Sub HandlerMatr2KnrEnrKenrElavList
Declare Sub HandlerMatr2KnrEnrKenrElavButton
Declare Sub Matr2KnrEnrKenrElavListCTRL(ByVal nCtrl As Integer, ByVal bSelectAll As Logical, ByVal bReCalled As Logical)
Declare Sub Matr2KnrEnrKenrElavButtonCTRL(ByVal nCtrl As Integer)

'------------
Declare Sub HandlerMatr2KnrEnrElavLoad
Declare Sub HandlerMatr2KnrEnrElavList
Declare Sub HandlerMatr2KnrEnrElavButton
Declare Sub Matr2KnrEnrElavListCTRL(ByVal nCtrl As Integer, ByVal bSelectAll As Logical, ByVal bReCalled As Logical)
Declare Sub Matr2KnrEnrElavButtonCTRL(ByVal nCtrl As Integer)

'------------
Declare Sub HandlerMatr2OpslagZoom

Dim	marrValues1(), marrValues2(), marrValues3(), marrValues4(), marrValues5() As String,
	marrssdInfo1(5), marrssdInfo2(5) As T_SRCH_SETTINGS_DIALOG

'**********************************************************************************************''
' Dialog til opslagssøgning i en enkelte tabel
'**********************************************************************************************''
Sub SRCHOpslagMatrTwoTables(sbtnCur As T_SEARCHBTN)

Dim	i, j As Integer,
	szTab, szCol As String

OnError GoTo ErrorOccured

	'Nulstiller arrays med tabeller, kolonner og betingelser
	For i = 1 To Ubound(marrssdInfo1)
		marrssdInfo1(i).szTab	= ""
		marrssdInfo1(i).szCol	= ""
		marrssdInfo1(i).szCond	= ""
		marrssdInfo1(i).szDesc	= ""
	Next
	For i = 1 To Ubound(marrssdInfo2)
		marrssdInfo2(i).szTab	= ""
		marrssdInfo2(i).szCol	= ""
		marrssdInfo2(i).szCond	= ""
		marrssdInfo2(i).szDesc	= ""
	Next

	'**Checking table structure
	For i = 1 To Ubound(sbtnCur.stabTabs)
		szTab = sbtnCur.stabTabs(i).szName
		If szTab = "" Then
			Note ERR_KPAK_NO_SEARCH_TAB_NAME & " (" & i & ")"
			Exit Sub
		ElseIf NOT TableOpen(szTab) Then
			Note ERR_KPAK_SEARCH_TAB_NOT_OPEN & szTab
			Exit Sub
		End If
		
		For j = 1 To Ubound(sbtnCur.stabTabs(i).scolCols)
			szCol = sbtnCur.stabTabs(i).scolCols(j).szName
			If szCol = "" Then
				Note ERR_KPAK_NO_SEARCH_COL_NAME & " (" & sbtnCur.stabTabs(i).scolCols(j).szDescription & ")"
				Exit Sub
			ElseIf NOT ColExist(szTab, szCol) Then
				Note ERR_KPAK_SEARCH_COL_DONT_EXIST & szTab & "(" & szCol & ")"
				Exit Sub
			ElseIf NOT ColumnInfo(szTab, szCol, COL_INFO_INDEXED) AND SRCHPrintIndexImprovement() Then
				If j <> Ubound(sbtnCur.stabTabs(1).scolCols) Then
					Print "Søgningen kan eventuelt optimeres ved at oprette indeks på denne kolonne: " & szTab & "(" & szCol & ")"
				End If
			End If
		Next	'j
	Next	'i

	Do Case sbtnCur.nSearchType
		Case SSTYPE_6_ENR_ELAV_MNR, 601, 1
			Call SRCHOpslagMatr2EnrElavMnr(sbtnCur)

		Case SSTYPE_6_ENR_KENR_ELAV_MNR, 602, 2
			Call SRCHOpslagMatr2EnrKenrElavMnr(sbtnCur)

		Case SSTYPE_6_KNR_ENR_ELAV_MNR, 603, 3
			Call SRCHOpslagMatr2KnrEnrElavMnr(sbtnCur)

		Case SSTYPE_6_KNR_ENR_KENR_ELAV_MNR, 604, 4
			Call SRCHOpslagMatr2KnrEnrKenrElavMnr(sbtnCur)
			
		Case Else
			Note "Ukendt søgetype: " & sbtnCur.nSearchType
	End Case

	'Nulstiller array's med værdier
	ReDim marrValues1(0)
	ReDim marrValues2(0)
	ReDim marrValues3(0)
	ReDim marrValues4(0)
	ReDim marrValues5(0)

	Exit Sub
'-------------------------
ErrorOccured:
	Note ERR_ERRORMSG & lf & Error$()

End Sub

'**************************************************************************************************************************''
'   M A T R I K E L O P S L A G :  E J E R L A V  +  M A T R N R
'**************************************************************************************************************************''
'**********************************************************************************************''
' Dialog til opslagssøgning i en enkelte tabel - Elav & Matrnr
'**********************************************************************************************''
Sub SRCHOpslagMatr2EnrElavMnr(sbtnCur As T_SEARCHBTN)

OnError GoTo ErrorOccured

	'Ejerlavstabel
	marrssdInfo1(2).szTab	= sbtnCur.stabTabs(2).szName
	marrssdInfo1(4).szTab	= sbtnCur.stabTabs(2).szName
	marrssdInfo1(2).szCol	= sbtnCur.stabTabs(2).scolCols(1).szName
	marrssdInfo1(4).szCol	= sbtnCur.stabTabs(2).scolCols(2).szName
	marrssdInfo1(2).szDesc	= sbtnCur.stabTabs(2).scolCols(1).szDescription
	marrssdInfo1(4).szDesc	= sbtnCur.stabTabs(2).scolCols(2).szDescription
	'Matrikeltabel
	marrssdInfo2(2).szTab	= sbtnCur.stabTabs(1).szName
	marrssdInfo2(5).szTab	= sbtnCur.stabTabs(1).szName
	marrssdInfo2(2).szCol	= sbtnCur.stabTabs(1).scolCols(1).szName
	marrssdInfo2(5).szCol	= sbtnCur.stabTabs(1).scolCols(2).szName
	marrssdInfo2(2).szDesc	= sbtnCur.stabTabs(1).scolCols(1).szDescription
	marrssdInfo2(5).szDesc	= sbtnCur.stabTabs(1).scolCols(2).szDescription


	If sbtnCur.nZoom < 1 Then
		sbtnCur.nZoom = VALUE_DEFAULT_ZOOM
	End If

	Dialog
		Title "Søgning (Jokertegn: % eller _)"
		Calling HandlerMatr2EnrElavLoad
		'----------
		Control StaticText	Position 5,5					ID SRCH_CTRL_MATR_LANDSELAVNR_TITLE
			Title marrssdInfo1(2).szDesc
		Control EditText		Position 5,15	Width 50			ID SRCH_CTRL_MATR_LANDSELAVNR_VALUE
		Control Button		Position 55,15	Width 15	Height 12	ID SRCH_CTRL_MATR_LANDSELAVNR_BUTTON
			Calling HandlerMatr2EnrElavButton
			Title ">>"
		Control ListBox		Position 5,27	Width 65	Height 80	ID SRCH_CTRL_MATR_LANDSELAVNR_LIST
			Calling HandlerMatr2EnrElavList
		'----------
		Control StaticText	Position 75,5					ID SRCH_CTRL_MATR_LANDSELAV_TITLE
			Title marrssdInfo1(4).szDesc
		Control EditText		Position 75,15	Width 110			ID SRCH_CTRL_MATR_LANDSELAV_VALUE
		Control Button		Position 185,15	Width 15	Height 12	ID SRCH_CTRL_MATR_LANDSELAV_BUTTON
			Calling HandlerMatr2EnrElavButton
			Title ">>"
		Control ListBox		Position 75,27	Width 125	Height 80	ID SRCH_CTRL_MATR_LANDSELAV_LIST
			Calling HandlerMatr2EnrElavList
		'----------
		Control StaticText	Position 205,5					ID SRCH_CTRL_MATR_MATRNR_TITLE
			Title marrssdInfo2(5).szDesc
		Control EditText		Position 205,15	Width 35			ID SRCH_CTRL_MATR_MATRNR_VALUE
		Control Button		Position 240,15	Width 15	Height 12	ID SRCH_CTRL_MATR_MATRNR_BUTTON
			Calling HandlerMatr2EnrElavButton
			Title ">>"
		Control ListBox		Position 205,27	Width 50	Height 80	ID SRCH_CTRL_MATR_MATRNR_LIST
			Calling HandlerMatr2EnrElavList

		'----------
		Control StaticText	Position 5,112
			Title "Zoom, m"
		Control EditText		Position 40,110	Width 30			ID SRCH_CTRL_MATR_ZOOM
			Value Str$(sbtnCur.nZoom)
		Control Button		Position 70,110	Width 30	Height 12
			Calling HandlerMatr2OpslagZoom
			Title "Zoom"

		Control CheckBox		Position 105,112					ID SRCH_CTRL_MATR_AUTOCLOSE
			Title "&Auto luk"
			Value SRCHAutoCloseSearchDialog()

			
		Control CancelButton	Position 210,110	Width 40
			Title MSG_CLOSE
					
	Exit Sub
'-------------------------
ErrorOccured:
	Note ERR_ERRORMSG & lf & Error$()

End Sub

'**********************************************************************************************''
'Handler - Loading dialog and setting up controls
'**********************************************************************************************''
Sub HandlerMatr2EnrElavLoad

OnError GoTo ErrorOccured

	Call Matr2EnrElavButtonCTRL(SRCH_CTRL_MATR_LANDSELAVNR_BUTTON)
	Call Matr2EnrElavButtonCTRL(SRCH_CTRL_MATR_LANDSELAV_BUTTON)

	Exit Sub
'-------------------------
ErrorOccured:
	Note ERR_ERRORMSG & lf & Error$()

End Sub

'**********************************************************************************************''
'Handler - Der blev udpeget en post i en liste
'**********************************************************************************************''
Sub HandlerMatr2EnrElavList

Dim	nCtrl As Integer,
	bSelectAll As Logical

OnError GoTo ErrorOccured

	nCtrl		= TriggerControl()
	bSelectAll	= CommandInfo(CMD_INFO_DLG_DBL)
	
	Call Matr2EnrElavListCTRL(nCtrl, bSelectAll, FALSE)

	Exit Sub
'-------------------------
ErrorOccured:
	Note ERR_ERRORMSG & lf & Error$()

End Sub

'**********************************************************************************************''
'Handler - Der blev udpeget en post i en liste
'**********************************************************************************************''
Sub Matr2EnrElavListCTRL(ByVal nCtrl As Integer, ByVal bSelectAll As Logical, ByVal bReCalled As Logical)

Dim	nCtrlItem, nItem As Integer,
	szValue, szCmdStr As String

OnError GoTo ErrorOccured

	nCtrlItem	= nCtrl / 100
	nItem		= ReadControlValue(nCtrl)

	Do Case nCtrlItem
		Case 2	'LANDSEJERLAVNR
			If nItem = 0 Then
				ReDim marrValues5(0)
			Else
				szValue = marrValues2(nItem)
				marrssdInfo1(nCtrlItem).szCond = SRCHGetConditionFromValue$(marrssdInfo1(nCtrlItem).szTab, marrssdInfo1(nCtrlItem).szCol, "=", szValue)
				marrssdInfo2(nCtrlItem).szCond = SRCHGetConditionFromValue$(marrssdInfo2(nCtrlItem).szTab, marrssdInfo2(nCtrlItem).szCol, "=", szValue)

				'**Finding the matching LANDSEJERLAVNAVN
				If NOT bReCalled Then
					If NOT SRCHShowMatchValueInListControl(SRCH_CTRL_MATR_LANDSELAV_LIST, marrssdInfo1(nCtrlItem).szTab,
							marrssdInfo1(nCtrlItem).szCol, marrssdInfo1(4).szCol, marrssdInfo1(nCtrlItem).szCond, marrValues4) Then
					
						Note szValue & ": Tilsvarende " & marrssdInfo1(4).szDesc & " ikke fundet!"
					End If				
				End If
			End If

			Call Matr2EnrElavButtonCTRL(SRCH_CTRL_MATR_MATRNR_BUTTON)

			If bSelectAll Then
				Call HandlerMatr2OpslagZoom
				Call SRCHSelectAll(marrssdInfo2(nCtrlItem).szTab, marrssdInfo2(nCtrlItem).szCond)
			End If

		Case 4	'LANDSEJERLAVNAVN
			If nItem = 0 Then
				ReDim marrValues5(0)
			Else
				szValue = marrValues4(nItem)
				marrssdInfo1(nCtrlItem).szCond = SRCHGetConditionFromValue$(marrssdInfo1(nCtrlItem).szTab, marrssdInfo1(nCtrlItem).szCol, "=", szValue)

				'**Finding the matching LANDSEJERLAVNR
				If NOT SRCHShowMatchValueInListControl(SRCH_CTRL_MATR_LANDSELAVNR_LIST, marrssdInfo1(nCtrlItem).szTab,
						marrssdInfo1(nCtrlItem).szCol, marrssdInfo1(2).szCol, marrssdInfo1(nCtrlItem).szCond, marrValues2) Then
				
					Note szValue & ": Tilsvarende " & marrssdInfo1(2).szDesc & " ikke fundet!"
				End If				
	
			End If

			'Calling This handler as if it was called from SRCH_CTRL_MATR_LANDSELAV_LIST
			Call Matr2EnrElavListCTRL(SRCH_CTRL_MATR_LANDSELAVNR_LIST, bSelectAll, TRUE)

		Case 5	'MATR.NR.
			szValue = marrValues5(nItem)
			marrssdInfo2(nCtrlItem).szCond = SRCHGetConditionFromValue$(marrssdInfo2(nCtrlItem).szTab, marrssdInfo2(nCtrlItem).szCol, "=", szValue)
			marrssdInfo2(nCtrlItem).szCond = SRCHCombineConditions$(marrssdInfo2(2).szCond, marrssdInfo2(nCtrlItem).szCond)
		
			Call HandlerMatr2OpslagZoom
			Call SRCHSelectAll(marrssdInfo2(nCtrlItem).szTab, marrssdInfo2(nCtrlItem).szCond)

			If ReadControlValue(SRCH_CTRL_MATR_AUTOCLOSE) Then
				Dialog Remove
			End If
	End Case

	Exit Sub
'-------------------------
ErrorOccured:
	Note ERR_ERRORMSG & lf & Error$()

End Sub

'**********************************************************************************************''
'Handler - Der blev trykket på 'søg' knappen
'**********************************************************************************************''
Sub HandlerMatr2EnrElavButton

Dim	nCtrl As Integer

OnError GoTo ErrorOccured

	nCtrl		= TriggerControl()
	Call Matr2EnrElavButtonCTRL(nCtrl)

	Exit Sub
'-------------------------
ErrorOccured:
	Note ERR_ERRORMSG & lf & Error$()

End Sub

'**********************************************************************************************''
'Handler - Der blev trykket på 'søg' knappen
'**********************************************************************************************''
Sub Matr2EnrElavButtonCTRL(ByVal nCtrl As Integer)

Dim	nCtrlItem, nLstCtrl As Integer,
	szValue, szCond As String

OnError GoTo ErrorOccured

	nCtrlItem	= (nCtrl - 3) / 100

	Do Case nCtrlItem
		Case 2	'LANDSEJERLAVNR
			nLstCtrl	= nCtrl - 3
			szValue	= ReadControlValue(nLstCtrl + 2)
			szCond	= SRCHGetConditionFromValue$(marrssdInfo1(nCtrlItem).szTab, marrssdInfo1(nCtrlItem).szCol, "Like", szValue)

			If SRCHLoadValuesIntoListControl(nLstCtrl, -1, marrssdInfo1(nCtrlItem).szTab, marrssdInfo1(nCtrlItem).szCol, szCond, marrValues2, FALSE) Then
				Call Matr2EnrElavListCTRL(nLstCtrl, FALSE, FALSE)
			End If

		Case 4	'LANDSEJERLAVNAVN
			nLstCtrl	= nCtrl - 3
			szValue	= ReadControlValue(nLstCtrl + 2)
			szCond	= SRCHGetConditionFromValue$(marrssdInfo1(nCtrlItem).szTab, marrssdInfo1(nCtrlItem).szCol, "Like", szValue)

			If SRCHLoadValuesIntoListControl(nLstCtrl, -1, marrssdInfo1(nCtrlItem).szTab, marrssdInfo1(nCtrlItem).szCol, szCond, marrValues4, FALSE) Then
				Call Matr2EnrElavListCTRL(nLstCtrl, FALSE, FALSE)
			End If

		Case 5	'MATR.NR.
			nLstCtrl	= nCtrl - 3
			szValue	= ReadControlValue(nLstCtrl + 2)
			szCond	= SRCHGetConditionFromValue$(marrssdInfo2(nCtrlItem).szTab, marrssdInfo2(nCtrlItem).szCol, "Like", szValue)
			szCond 	= SRCHCombineConditions$(marrssdInfo2(2).szCond, szCond)

			If SRCHLoadValuesIntoListControl(nLstCtrl, -1, marrssdInfo2(nCtrlItem).szTab, marrssdInfo2(nCtrlItem).szCol, szCond, marrValues5, TRUE) Then
				Call Matr2EnrElavListCTRL(nLstCtrl, FALSE, FALSE)
			End If
	End Case
	
	Exit Sub
'-------------------------
ErrorOccured:
	Note ERR_ERRORMSG & lf & Error$()

End Sub

'**********************************************************************************************''
'Der blev trykket på knappen til zoom
'**********************************************************************************************''
Sub HandlerMatr2OpslagZoom

Dim	nMID As Integer,
	fZoom As Float

OnError GoTo ErrorOccured

	nMID = FrontWindow()
	If nMID > 0 Then
		If WindowInfo(nMID, WIN_INFO_TYPE) = WIN_MAPPER Then
			fZoom	= Val(KommaToPoint(ReadControlValue(SRCH_CTRL_MATR_ZOOM)))
			If fZoom < 1 Then
				fZoom = VALUE_DEFAULT_ZOOM
			End If
			
			Set Map
				Window nMID
				Zoom fZoom Units "m"	
		End If
	End If

	'**Setting value for AutoClose
	Call SRCHSetAutoCloseSearchDialog(ReadControlValue(SRCH_CTRL_MATR_AUTOCLOSE))

	Exit Sub
'-------------------------
ErrorOccured:
	Note ERR_ERRORMSG & lf & Error$()

End Sub

'**************************************************************************************************************************''
'   M A T R I K E L O P S L A G :  K O M N R  +  E J E R L A V S N R  +  E J E R L A V  +  M A T R N R
'**************************************************************************************************************************''
'**********************************************************************************************''
' Dialog til opslagssøgning i en enkelte tabel - Knr + Elav & Matrnr
'**********************************************************************************************''
Sub SRCHOpslagMatr2EnrKenrElavMnr(sbtnCur As T_SEARCHBTN)

OnError GoTo ErrorOccured

	'Ejerlavstabel
	marrssdInfo1(2).szTab	= sbtnCur.stabTabs(2).szName
	marrssdInfo1(3).szTab	= sbtnCur.stabTabs(2).szName
	marrssdInfo1(4).szTab	= sbtnCur.stabTabs(2).szName
	marrssdInfo1(2).szCol	= sbtnCur.stabTabs(2).scolCols(1).szName
	marrssdInfo1(3).szCol	= sbtnCur.stabTabs(2).scolCols(2).szName
	marrssdInfo1(4).szCol	= sbtnCur.stabTabs(2).scolCols(3).szName
	marrssdInfo1(2).szDesc	= sbtnCur.stabTabs(2).scolCols(1).szDescription
	marrssdInfo1(3).szDesc	= sbtnCur.stabTabs(2).scolCols(2).szDescription
	marrssdInfo1(4).szDesc	= sbtnCur.stabTabs(2).scolCols(3).szDescription
	'Matrikeltabel
	marrssdInfo2(2).szTab	= sbtnCur.stabTabs(1).szName
	marrssdInfo2(5).szTab	= sbtnCur.stabTabs(1).szName
	marrssdInfo2(2).szCol	= sbtnCur.stabTabs(1).scolCols(1).szName
	marrssdInfo2(5).szCol	= sbtnCur.stabTabs(1).scolCols(2).szName
	marrssdInfo2(2).szDesc	= sbtnCur.stabTabs(1).scolCols(1).szDescription
	marrssdInfo2(5).szDesc	= sbtnCur.stabTabs(1).scolCols(2).szDescription
	
	If sbtnCur.nZoom < 1 Then
		sbtnCur.nZoom = VALUE_DEFAULT_ZOOM
	End If

	Dialog
		Title "Søgning (Jokertegn: % eller _)"
		Calling HandlerMatr2EnrKenrElavLoad
		'----------
		Control StaticText	Position 5,5					ID SRCH_CTRL_MATR_LANDSELAVNR_TITLE
			Title marrssdInfo1(2).szDesc
		Control EditText		Position 5,15	Width 50			ID SRCH_CTRL_MATR_LANDSELAVNR_VALUE
		Control Button		Position 55,15	Width 15	Height 12	ID SRCH_CTRL_MATR_LANDSELAVNR_BUTTON
			Calling HandlerMatr2EnrKenrElavButton
			Title ">>"
		Control ListBox		Position 5,27	Width 65	Height 80	ID SRCH_CTRL_MATR_LANDSELAVNR_LIST
			Calling HandlerMatr2EnrKenrElavList
		'----------
		Control StaticText	Position 75,5					ID SRCH_CTRL_MATR_KOMMELAVNR_TITLE
			Title marrssdInfo1(3).szDesc
		Control EditText		Position 75,15	Width 50			ID SRCH_CTRL_MATR_KOMMELAVNR_VALUE
		Control Button		Position 125,15	Width 15	Height 12	ID SRCH_CTRL_MATR_KOMMELAVNR_BUTTON
			Calling HandlerMatr2EnrKenrElavButton
			Title ">>"
		Control ListBox		Position 75,27	Width 65	Height 80	ID SRCH_CTRL_MATR_KOMMELAVNR_LIST
			Calling HandlerMatr2EnrKenrElavList
		'----------
		Control StaticText	Position 150,5					ID SRCH_CTRL_MATR_LANDSELAV_TITLE
			Title marrssdInfo1(4).szDesc
		Control EditText		Position 150,15	Width 110			ID SRCH_CTRL_MATR_LANDSELAV_VALUE
		Control Button		Position 260,15	Width 15	Height 12	ID SRCH_CTRL_MATR_LANDSELAV_BUTTON
			Calling HandlerMatr2EnrKenrElavButton
			Title ">>"
		Control ListBox		Position 150,27	Width 125	Height 80	ID SRCH_CTRL_MATR_LANDSELAV_LIST
			Calling HandlerMatr2EnrKenrElavList
		'----------
		Control StaticText	Position 280,5					ID SRCH_CTRL_MATR_MATRNR_TITLE
			Title marrssdInfo2(5).szDesc
		Control EditText		Position 280,15	Width 35			ID SRCH_CTRL_MATR_MATRNR_VALUE
		Control Button		Position 315,15	Width 15	Height 12	ID SRCH_CTRL_MATR_MATRNR_BUTTON
			Calling HandlerMatr2EnrKenrElavButton
			Title ">>"
		Control ListBox		Position 280,27	Width 50	Height 80	ID SRCH_CTRL_MATR_MATRNR_LIST
			Calling HandlerMatr2EnrKenrElavList

		'----------
		Control StaticText	Position 5,112
			Title "Zoom, m"
		Control EditText		Position 40,110	Width 30			ID SRCH_CTRL_MATR_ZOOM
			Value Str$(sbtnCur.nZoom)
		Control Button		Position 70,110	Width 30	Height 12
			Calling HandlerMatr2OpslagZoom
			Title "Zoom"

		Control CheckBox		Position 105,112					ID SRCH_CTRL_MATR_AUTOCLOSE
			Title "&Auto luk"
			Value SRCHAutoCloseSearchDialog()
			
		Control CancelButton	Position 285,110	Width 40
			Title MSG_CLOSE
					
	Exit Sub
'-------------------------
ErrorOccured:
	Note ERR_ERRORMSG & lf & Error$()

End Sub

'**********************************************************************************************''
'Handler - Loading dialog and setting up controls
'**********************************************************************************************''
Sub HandlerMatr2EnrKenrElavLoad

Dim	bUseFirst, bUseSecond As Logical

OnError GoTo ErrorOccured

	Call Matr2EnrKenrElavButtonCTRL(SRCH_CTRL_MATR_LANDSELAVNR_BUTTON)
	Call Matr2EnrKenrElavButtonCTRL(SRCH_CTRL_MATR_KOMMELAVNR_BUTTON)
	Call Matr2EnrKenrElavButtonCTRL(SRCH_CTRL_MATR_LANDSELAV_BUTTON)

	Exit Sub
'-------------------------
ErrorOccured:
	Note ERR_ERRORMSG & lf & Error$()

End Sub

'**********************************************************************************************''
'Handler - Der blev udpeget en post i en liste
'**********************************************************************************************''
Sub HandlerMatr2EnrKenrElavList

Dim	nCtrl As Integer,
	bSelectAll As Logical

OnError GoTo ErrorOccured

	nCtrl		= TriggerControl()
	bSelectAll	= CommandInfo(CMD_INFO_DLG_DBL)
	
	Call Matr2EnrKenrElavListCTRL(nCtrl, bSelectAll, FALSE)

	Exit Sub
'-------------------------
ErrorOccured:
	Note ERR_ERRORMSG & lf & Error$()

End Sub

'**********************************************************************************************''
'Handler - Der blev udpeget en post i en liste
'**********************************************************************************************''
Sub Matr2EnrKenrElavListCTRL(ByVal nCtrl As Integer, ByVal bSelectAll As Logical, ByVal bReCalled As Logical)

Dim	nCtrlItem, nItem, nMatchItem As Integer,
	szValue, szMatchVal, szCmdStr As String

OnError GoTo ErrorOccured

	nCtrlItem	= nCtrl / 100
	nItem		= ReadControlValue(nCtrl)

	Do Case nCtrlItem
		'---------------------------------------------
		Case 2	'LANDSEJERLAVKODE
			If nItem = 0 Then
				ReDim marrValues5
			Else
				szValue = marrValues2(nItem)
				marrssdInfo1(nCtrlItem).szCond = SRCHGetConditionFromValue$(marrssdInfo1(nCtrlItem).szTab, marrssdInfo1(nCtrlItem).szCol, "=", szValue)
				marrssdInfo2(nCtrlItem).szCond = SRCHGetConditionFromValue$(marrssdInfo2(nCtrlItem).szTab, marrssdInfo2(nCtrlItem).szCol, "=", szValue)
		
				If NOT bReCalled Then
					'**Finding the matching LANDSEJERLAV
					If NOT SRCHShowMatchValueInListControl(SRCH_CTRL_MATR_LANDSELAV_LIST, marrssdInfo1(nCtrlItem).szTab,
							marrssdInfo1(nCtrlItem).szCol, marrssdInfo1(4).szCol, marrssdInfo1(nCtrlItem).szCond, marrValues4) Then
					
						Note szValue & ": Tilsvarende " & marrssdInfo1(4).szDesc & " ikke fundet!"
					End If
					'**Finding the matching KOMEJERLAVNR
					If NOT SRCHShowMatchValueInListControl(SRCH_CTRL_MATR_KOMMELAVNR_LIST, marrssdInfo1(nCtrlItem).szTab,
							marrssdInfo1(nCtrlItem).szCol, marrssdInfo1(3).szCol, marrssdInfo1(nCtrlItem).szCond, marrValues3) Then
					
						Note szValue & ": Tilsvarende " & marrssdInfo1(3).szDesc & " ikke fundet!"
					End If				
				End If
			End If
				
			Call Matr2EnrKenrElavButtonCTRL(SRCH_CTRL_MATR_MATRNR_BUTTON)
		
			If bSelectAll Then
				Call HandlerMatr2OpslagZoom
				Call SRCHSelectAll(marrssdInfo2(nCtrlItem).szTab, marrssdInfo2(nCtrlItem).szCond)
			End If

		'---------------------------------------------
		Case 3	'KOMMEJERLAVNR
			If nItem = 0 Then
				ReDim marrValues5
			Else
				szValue = marrValues3(nItem)
				marrssdInfo1(nCtrlItem).szCond = SRCHGetConditionFromValue$(marrssdInfo1(nCtrlItem).szTab, marrssdInfo1(nCtrlItem).szCol, "=", szValue)
	
				'**Finding the matching LANDSEJERLAVNR
				If NOT SRCHShowMatchValueInListControl(SRCH_CTRL_MATR_LANDSELAVNR_LIST, marrssdInfo1(nCtrlItem).szTab,
						marrssdInfo1(nCtrlItem).szCol, marrssdInfo1(2).szCol, marrssdInfo1(nCtrlItem).szCond, marrValues2) Then
				
					Note szValue & ": Tilsvarende " & marrssdInfo1(2).szDesc & " ikke fundet!"
				End If				
				'**Finding the matching LANDSEJERLAV
				If NOT SRCHShowMatchValueInListControl(SRCH_CTRL_MATR_LANDSELAV_LIST, marrssdInfo1(nCtrlItem).szTab,
						marrssdInfo1(nCtrlItem).szCol, marrssdInfo1(4).szCol, marrssdInfo1(nCtrlItem).szCond, marrValues4) Then
				
					Note szValue & ": Tilsvarende " & marrssdInfo1(4).szDesc & " ikke fundet!"
				End If
			End If

			Call Matr2EnrKenrElavListCTRL(SRCH_CTRL_MATR_LANDSELAVNR_LIST, bSelectAll, TRUE)
						
		'---------------------------------------------
		Case 4	'LANDSEJERLAVNAVN
			If nItem = 0 Then
				ReDim marrValues5
			Else
				szValue = marrValues4(nItem)
				marrssdInfo1(nCtrlItem).szCond = SRCHGetConditionFromValue$(marrssdInfo1(nCtrlItem).szTab, marrssdInfo1(nCtrlItem).szCol, "=", szValue)
	
				'**Finding the matching LANDSEJERLAVNR
				If NOT SRCHShowMatchValueInListControl(SRCH_CTRL_MATR_LANDSELAVNR_LIST, marrssdInfo1(nCtrlItem).szTab,
						marrssdInfo1(nCtrlItem).szCol, marrssdInfo1(2).szCol, marrssdInfo1(nCtrlItem).szCond, marrValues2) Then
				
					Note szValue & ": Tilsvarende " & marrssdInfo1(2).szDesc & " ikke fundet!"
				End If				
				'**Finding the matching KOMEJERLAVNR
				If NOT SRCHShowMatchValueInListControl(SRCH_CTRL_MATR_KOMMELAVNR_LIST, marrssdInfo1(nCtrlItem).szTab,
						marrssdInfo1(nCtrlItem).szCol, marrssdInfo1(3).szCol, marrssdInfo1(nCtrlItem).szCond, marrValues3) Then
				
					Note szValue & ": Tilsvarende " & marrssdInfo1(3).szDesc & " ikke fundet!"
				End If				
			End If

			Call Matr2EnrKenrElavListCTRL(SRCH_CTRL_MATR_LANDSELAVNR_LIST, bSelectAll, TRUE)

		'---------------------------------------------
		Case 5	'MATR.NR.
			If nItem = 0 Then
				Exit Sub
			End If

			szValue = marrValues5(nItem)
			marrssdInfo2(nCtrlItem).szCond = SRCHGetConditionFromValue$(marrssdInfo2(nCtrlItem).szTab, marrssdInfo2(nCtrlItem).szCol, "=", szValue)
			marrssdInfo2(nCtrlItem).szCond = SRCHCombineConditions$(marrssdInfo2(2).szCond, marrssdInfo2(nCtrlItem).szCond)

			Call HandlerMatr2OpslagZoom
			Call SRCHSelectAll(marrssdInfo2(nCtrlItem).szTab, marrssdInfo2(nCtrlItem).szCond)
			
			If ReadControlValue(SRCH_CTRL_MATR_AUTOCLOSE) Then
				Dialog Remove
			End If
	End Case

	Exit Sub
'-------------------------
ErrorOccured:
	Note ERR_ERRORMSG & lf & Error$()

End Sub

'**********************************************************************************************''
'Handler - Der blev trykket på 'søg' knappen
'**********************************************************************************************''
Sub HandlerMatr2EnrKenrElavButton

Dim	nCtrl As Integer

OnError GoTo ErrorOccured

	nCtrl		= TriggerControl()
	Call Matr2EnrKenrElavButtonCTRL(nCtrl)

	Exit Sub
'-------------------------
ErrorOccured:
	Note ERR_ERRORMSG & lf & Error$()

End Sub

'**********************************************************************************************''
'Handler - Der blev trykket på 'søg' knappen
'**********************************************************************************************''
Sub Matr2EnrKenrElavButtonCTRL(ByVal nCtrl As Integer)

Dim	nCtrlItem, nLstCtrl As Integer,
	szValue, szCond As String

OnError GoTo ErrorOccured

	nCtrlItem	= (nCtrl - 3) / 100

	Do Case nCtrlItem
		Case 2	'LANDSEJERLAVKODE
			nLstCtrl	= nCtrl - 3
			szValue	= ReadControlValue(nLstCtrl + 2)
			szCond	= SRCHGetConditionFromValue$(marrssdInfo1(nCtrlItem).szTab, marrssdInfo1(nCtrlItem).szCol, "Like", szValue)
		
			If SRCHLoadValuesIntoListControl(nLstCtrl, -1, marrssdInfo1(nCtrlItem).szTab, marrssdInfo1(nCtrlItem).szCol, szCond, marrValues2, FALSE) Then
				Call Matr2EnrKenrElavListCTRL(nLstCtrl, FALSE, FALSE)
			End If
			
		Case 3	'KOMMEJERLAVNR
			nLstCtrl	= nCtrl - 3
			szValue	= ReadControlValue(nLstCtrl + 2)
			szCond	= SRCHGetConditionFromValue$(marrssdInfo1(nCtrlItem).szTab, marrssdInfo1(nCtrlItem).szCol, "Like", szValue)

			If SRCHLoadValuesIntoListControl(nLstCtrl, -1, marrssdInfo1(nCtrlItem).szTab, marrssdInfo1(nCtrlItem).szCol, szCond, marrValues3, FALSE) Then
				Call Matr2EnrKenrElavListCTRL(nLstCtrl, FALSE, FALSE)
			End If

		Case 4	'LANDSEJERLAVNAVN
			nLstCtrl	= nCtrl - 3
			szValue	= ReadControlValue(nLstCtrl + 2)
			szCond	= SRCHGetConditionFromValue$(marrssdInfo1(nCtrlItem).szTab, marrssdInfo1(nCtrlItem).szCol, "Like", szValue)

			If SRCHLoadValuesIntoListControl(nLstCtrl, -1, marrssdInfo1(nCtrlItem).szTab, marrssdInfo1(nCtrlItem).szCol, szCond, marrValues4, FALSE) Then
				Call Matr2EnrKenrElavListCTRL(nLstCtrl, FALSE, FALSE)
			End If

		Case 5	'MATR.NR.
			nLstCtrl	= nCtrl - 3
			szValue	= ReadControlValue(nLstCtrl + 2)
			szCond	= SRCHGetConditionFromValue$(marrssdInfo2(nCtrlItem).szTab, marrssdInfo2(nCtrlItem).szCol, "Like", szValue)
			szCond 	= SRCHCombineConditions$(marrssdInfo2(2).szCond, szCond)

			If SRCHLoadValuesIntoListControl(nLstCtrl, -1, marrssdInfo2(5).szTab, marrssdInfo2(nCtrlItem).szCol, szCond, marrValues5, TRUE) Then
				Call Matr2EnrKenrElavListCTRL(nLstCtrl, FALSE, FALSE)
			End If
	End Case
	
	Exit Sub
'-------------------------
ErrorOccured:
	Note ERR_ERRORMSG & lf & Error$()

End Sub

'**************************************************************************************************************************''
'   M A T R I K E L O P S L A G :  K O M N R  +  E J E R L A V  +  M A T R N R
'**************************************************************************************************************************''
'**********************************************************************************************''
' Dialog til opslagssøgning i en enkelte tabel - Knr + Elav & Matrnr
'**********************************************************************************************''
Sub SRCHOpslagMatr2KnrEnrKenrElavMnr(sbtnCur As T_SEARCHBTN)

OnError GoTo ErrorOccured

	'Ejerlavstabel
	marrssdInfo1(1).szTab	= sbtnCur.stabTabs(2).szName
	marrssdInfo1(2).szTab	= sbtnCur.stabTabs(2).szName
	marrssdInfo1(3).szTab	= sbtnCur.stabTabs(2).szName
	marrssdInfo1(4).szTab	= sbtnCur.stabTabs(2).szName
	marrssdInfo1(1).szCol	= sbtnCur.stabTabs(2).scolCols(1).szName
	marrssdInfo1(2).szCol	= sbtnCur.stabTabs(2).scolCols(2).szName
	marrssdInfo1(3).szCol	= sbtnCur.stabTabs(2).scolCols(3).szName
	marrssdInfo1(4).szCol	= sbtnCur.stabTabs(2).scolCols(4).szName
	marrssdInfo1(1).szDesc	= sbtnCur.stabTabs(2).scolCols(1).szDescription
	marrssdInfo1(2).szDesc	= sbtnCur.stabTabs(2).scolCols(2).szDescription
	marrssdInfo1(3).szDesc	= sbtnCur.stabTabs(2).scolCols(3).szDescription
	marrssdInfo1(4).szDesc	= sbtnCur.stabTabs(2).scolCols(4).szDescription
	'Matrikeltabel
	marrssdInfo2(1).szTab	= sbtnCur.stabTabs(1).szName
	marrssdInfo2(2).szTab	= sbtnCur.stabTabs(1).szName
	marrssdInfo2(5).szTab	= sbtnCur.stabTabs(1).szName
	marrssdInfo2(1).szCol	= sbtnCur.stabTabs(1).scolCols(1).szName
	marrssdInfo2(2).szCol	= sbtnCur.stabTabs(1).scolCols(2).szName
	marrssdInfo2(5).szCol	= sbtnCur.stabTabs(1).scolCols(3).szName
	marrssdInfo2(1).szDesc	= sbtnCur.stabTabs(1).scolCols(1).szDescription
	marrssdInfo2(2).szDesc	= sbtnCur.stabTabs(1).scolCols(2).szDescription
	marrssdInfo2(5).szDesc	= sbtnCur.stabTabs(1).scolCols(3).szDescription

	If sbtnCur.nZoom < 1 Then
		sbtnCur.nZoom = VALUE_DEFAULT_ZOOM
	End If

	Dialog
		Title "Søgning (Jokertegn: % eller _)"
		Calling HandlerMatr2KnrEnrKenrElavLoad
		'----------
		Control StaticText	Position 5,5					ID SRCH_CTRL_MATR_KOMMUNENR_TITLE
			Title marrssdInfo1(1).szDesc
		Control EditText		Position 5,15	Width 35			ID SRCH_CTRL_MATR_KOMMUNENR_VALUE
		Control Button		Position 40,15	Width 15	Height 12	ID SRCH_CTRL_MATR_KOMMUNENR_BUTTON
			Calling HandlerMatr2KnrEnrKenrElavButton
			Title ">>"
		Control ListBox		Position 5,27	Width 50	Height 80	ID SRCH_CTRL_MATR_KOMMUNENR_LIST
			Calling HandlerMatr2KnrEnrKenrElavList
		'----------
		Control StaticText	Position 60,5					ID SRCH_CTRL_MATR_LANDSELAVNR_TITLE
			Title marrssdInfo1(2).szDesc
		Control EditText		Position 60,15	Width 50			ID SRCH_CTRL_MATR_LANDSELAVNR_VALUE
		Control Button		Position 110,15	Width 15	Height 12	ID SRCH_CTRL_MATR_LANDSELAVNR_BUTTON
			Calling HandlerMatr2KnrEnrKenrElavButton
			Title ">>"
		Control ListBox		Position 60,27	Width 65	Height 80	ID SRCH_CTRL_MATR_LANDSELAVNR_LIST
			Calling HandlerMatr2KnrEnrKenrElavList
		'----------
		Control StaticText	Position 130,5					ID SRCH_CTRL_MATR_KOMMELAVNR_TITLE
			Title marrssdInfo1(3).szDesc
		Control EditText		Position 130,15	Width 50			ID SRCH_CTRL_MATR_KOMMELAVNR_VALUE
		Control Button		Position 180,15	Width 15	Height 12	ID SRCH_CTRL_MATR_KOMMELAVNR_BUTTON
			Calling HandlerMatr2KnrEnrKenrElavButton
			Title ">>"
		Control ListBox		Position 130,27	Width 65	Height 80	ID SRCH_CTRL_MATR_KOMMELAVNR_LIST
			Calling HandlerMatr2KnrEnrKenrElavList
		'----------
		Control StaticText	Position 200,5					ID SRCH_CTRL_MATR_LANDSELAV_TITLE
			Title marrssdInfo1(4).szDesc
		Control EditText		Position 200,15	Width 110			ID SRCH_CTRL_MATR_LANDSELAV_VALUE
		Control Button		Position 310,15	Width 15	Height 12	ID SRCH_CTRL_MATR_LANDSELAV_BUTTON
			Calling HandlerMatr2KnrEnrKenrElavButton
			Title ">>"
		Control ListBox		Position 200,27	Width 125	Height 80	ID SRCH_CTRL_MATR_LANDSELAV_LIST
			Calling HandlerMatr2KnrEnrKenrElavList
		'----------
		Control StaticText	Position 330,5					ID SRCH_CTRL_MATR_MATRNR_TITLE
			Title marrssdInfo2(5).szDesc
		Control EditText		Position 330,15	Width 35			ID SRCH_CTRL_MATR_MATRNR_VALUE
		Control Button		Position 365,15	Width 15	Height 12	ID SRCH_CTRL_MATR_MATRNR_BUTTON
			Calling HandlerMatr2KnrEnrKenrElavButton
			Title ">>"
		Control ListBox		Position 330,27	Width 50	Height 80	ID SRCH_CTRL_MATR_MATRNR_LIST
			Calling HandlerMatr2KnrEnrKenrElavList

		'----------
		Control StaticText	Position 5,112
			Title "Zoom, m"
		Control EditText		Position 40,110	Width 30			ID SRCH_CTRL_MATR_ZOOM
			Value Str$(sbtnCur.nZoom)
		Control Button		Position 70,110	Width 30	Height 12
			Calling HandlerMatr2OpslagZoom
			Title "Zoom"

		Control CheckBox		Position 105,112					ID SRCH_CTRL_MATR_AUTOCLOSE
			Title "&Auto luk"
			Value SRCHAutoCloseSearchDialog()
			
		Control CancelButton	Position 335,110	Width 40
			Title MSG_CLOSE
					
	Exit Sub
'-------------------------
ErrorOccured:
	Note ERR_ERRORMSG & lf & Error$()

End Sub

'**********************************************************************************************''
'Handler - Loading dialog and setting up controls
'**********************************************************************************************''
Sub HandlerMatr2KnrEnrKenrElavLoad

OnError GoTo ErrorOccured

	Call Matr2KnrEnrKenrElavButtonCTRL(SRCH_CTRL_MATR_KOMMUNENR_BUTTON)
	
	Exit Sub
'-------------------------
ErrorOccured:
	Note ERR_ERRORMSG & lf & Error$()

End Sub

'**********************************************************************************************''
'Handler - Der blev udpeget en post i en liste
'**********************************************************************************************''
Sub HandlerMatr2KnrEnrKenrElavList

Dim	nCtrl As Integer,
	bSelectAll As Logical

OnError GoTo ErrorOccured

	nCtrl		= TriggerControl()
	bSelectAll	= CommandInfo(CMD_INFO_DLG_DBL)
	
	Call Matr2KnrEnrKenrElavListCTRL(nCtrl, bSelectAll, FALSE)

	Exit Sub
'-------------------------
ErrorOccured:
	Note ERR_ERRORMSG & lf & Error$()

End Sub

'**********************************************************************************************''
'Handler - Der blev udpeget en post i en liste
'**********************************************************************************************''
Sub Matr2KnrEnrKenrElavListCTRL(ByVal nCtrl As Integer, ByVal bSelectAll As Logical, ByVal bReCalled As Logical)

Dim	nCtrlItem, nItem As Integer,
	szValue, szCmdStr As String

OnError GoTo ErrorOccured

	nCtrlItem	= nCtrl / 100
	nItem		= ReadControlValue(nCtrl)

	Do Case nCtrlItem
		Case 1	'KOMMUNENR
			If nItem = 0 Then
				ReDim marrValues2(0)
				ReDim marrValues3(0)
				ReDim marrValues4(0)
			Else
				szValue = marrValues1(nItem)
				marrssdInfo1(nCtrlItem).szCond = SRCHGetConditionFromValue$(marrssdInfo1(nCtrlItem).szTab, marrssdInfo1(nCtrlItem).szCol, "=", szValue)
				marrssdInfo2(nCtrlItem).szCond = SRCHGetConditionFromValue$(marrssdInfo2(nCtrlItem).szTab, marrssdInfo2(nCtrlItem).szCol, "=", szValue)
			End If

			Call Matr2KnrEnrKenrElavButtonCTRL(SRCH_CTRL_MATR_LANDSELAVNR_BUTTON)
			Call Matr2KnrEnrKenrElavButtonCTRL(SRCH_CTRL_MATR_KOMMELAVNR_BUTTON)
			Call Matr2KnrEnrKenrElavButtonCTRL(SRCH_CTRL_MATR_LANDSELAV_BUTTON)

			If bSelectAll Then
				Call HandlerMatr2OpslagZoom
				Call SRCHSelectAll(marrssdInfo2(nCtrlItem).szTab, marrssdInfo2(nCtrlItem).szCond)
			End If

		Case 2	'LANDSEJERLAVNR
			If nItem = 0 Then
				ReDim marrValues5
			Else
				szValue = marrValues2(nItem)
				marrssdInfo1(nCtrlItem).szCond = SRCHGetConditionFromValue$(marrssdInfo1(nCtrlItem).szTab, marrssdInfo1(nCtrlItem).szCol, "=", szValue)
				marrssdInfo2(nCtrlItem).szCond = SRCHGetConditionFromValue$(marrssdInfo2(nCtrlItem).szTab, marrssdInfo2(nCtrlItem).szCol, "=", szValue)
				marrssdInfo1(nCtrlItem).szCond = SRCHCombineConditions$(marrssdInfo1(1).szCond, marrssdInfo1(nCtrlItem).szCond)
				marrssdInfo2(nCtrlItem).szCond = SRCHCombineConditions$(marrssdInfo2(1).szCond, marrssdInfo2(nCtrlItem).szCond)
	
				If NOT bReCalled Then
					'**Finding the matching LANDSEJERLAVNAVN
					If NOT SRCHShowMatchValueInListControl(SRCH_CTRL_MATR_LANDSELAV_LIST, marrssdInfo1(nCtrlItem).szTab,
							marrssdInfo1(nCtrlItem).szCol, marrssdInfo1(4).szCol, marrssdInfo1(nCtrlItem).szCond, marrValues4) Then
					
						Note szValue & ": Tilsvarende " & marrssdInfo1(4).szDesc & " ikke fundet!"
					End If				
					'**Finding the matching KOMEJERLAVNR
					If NOT SRCHShowMatchValueInListControl(SRCH_CTRL_MATR_KOMMELAVNR_LIST, marrssdInfo1(nCtrlItem).szTab,
							marrssdInfo1(nCtrlItem).szCol, marrssdInfo1(3).szCol, marrssdInfo1(nCtrlItem).szCond, marrValues3) Then
					
						Note szValue & ": Tilsvarende " & marrssdInfo1(3).szDesc & " ikke fundet!"
					End If				
				End If
			End If

			Call Matr2KnrEnrKenrElavButtonCTRL(SRCH_CTRL_MATR_MATRNR_BUTTON)
		
			If bSelectAll Then
				Call HandlerMatr2OpslagZoom
				Call SRCHSelectAll(marrssdInfo2(nCtrlItem).szTab, marrssdInfo2(nCtrlItem).szCond)
			End If

		Case 3	'KOMMEJERLAVNR
			If nItem = 0 Then
				ReDim marrValues5
			Else
				szValue = marrValues3(nItem)
				marrssdInfo1(nCtrlItem).szCond = SRCHGetConditionFromValue$(marrssdInfo1(nCtrlItem).szTab, marrssdInfo1(nCtrlItem).szCol, "=", szValue)
				marrssdInfo1(nCtrlItem).szCond = SRCHCombineConditions$(marrssdInfo1(1).szCond, marrssdInfo1(nCtrlItem).szCond)
	
				'**Finding the matching LANDSEJERLAVNR
				If NOT SRCHShowMatchValueInListControl(SRCH_CTRL_MATR_LANDSELAVNR_LIST, marrssdInfo1(nCtrlItem).szTab,
						marrssdInfo1(nCtrlItem).szCol, marrssdInfo1(2).szCol, marrssdInfo1(nCtrlItem).szCond, marrValues2) Then
				
					Note szValue & ": Tilsvarende " & marrssdInfo1(2).szDesc & " ikke fundet!"
				End If				
				'**Finding the matching LANDSEJERLAVNAVN
				If NOT SRCHShowMatchValueInListControl(SRCH_CTRL_MATR_LANDSELAV_LIST, marrssdInfo1(nCtrlItem).szTab,
						marrssdInfo1(nCtrlItem).szCol, marrssdInfo1(4).szCol, marrssdInfo1(nCtrlItem).szCond, marrValues4) Then
				
					Note szValue & ": Tilsvarende " & marrssdInfo1(4).szDesc & " ikke fundet!"
				End If				
			End If

			Call Matr2KnrEnrKenrElavListCTRL(SRCH_CTRL_MATR_LANDSELAVNR_LIST, bSelectAll, TRUE)
									
		Case 4	'LANDSEJERLAVNAVN
			If nItem = 0 Then
				ReDim marrValues5
			Else
				szValue = marrValues4(nItem)
				marrssdInfo1(nCtrlItem).szCond = SRCHGetConditionFromValue$(marrssdInfo1(nCtrlItem).szTab, marrssdInfo1(nCtrlItem).szCol, "=", szValue)
				marrssdInfo1(nCtrlItem).szCond = SRCHCombineConditions$(marrssdInfo1(1).szCond, marrssdInfo1(nCtrlItem).szCond)
	
				'**Finding the matching LANDSEJERLAVNR
				If NOT SRCHShowMatchValueInListControl(SRCH_CTRL_MATR_LANDSELAVNR_LIST, marrssdInfo1(nCtrlItem).szTab,
						marrssdInfo1(nCtrlItem).szCol, marrssdInfo1(2).szCol, marrssdInfo1(nCtrlItem).szCond, marrValues2) Then
				
					Note szValue & ": Tilsvarende " & marrssdInfo1(2).szDesc & " ikke fundet!"
				End If				
				'**Finding the matching KOMEJERLAVNR
				If NOT SRCHShowMatchValueInListControl(SRCH_CTRL_MATR_KOMMELAVNR_LIST, marrssdInfo1(nCtrlItem).szTab,
						marrssdInfo1(nCtrlItem).szCol, marrssdInfo1(3).szCol, marrssdInfo1(nCtrlItem).szCond, marrValues3) Then
				
					Note szValue & ": Tilsvarende " & marrssdInfo1(3).szDesc & " ikke fundet!"
				End If				
			End If

			Call Matr2KnrEnrKenrElavListCTRL(SRCH_CTRL_MATR_LANDSELAVNR_LIST, bSelectAll, TRUE)

		Case 5	'MATR.NR.
			If nItem = 0 Then
				Exit Sub
			End If

			szValue = marrValues5(nItem)
			marrssdInfo2(nCtrlItem).szCond = SRCHGetConditionFromValue$(marrssdInfo2(nCtrlItem).szTab, marrssdInfo2(nCtrlItem).szCol, "=", szValue)
			marrssdInfo2(nCtrlItem).szCond = SRCHCombineConditions$(marrssdInfo2(2).szCond, marrssdInfo2(nCtrlItem).szCond)

			Call HandlerMatr2OpslagZoom
			Call SRCHSelectAll(marrssdInfo2(nCtrlItem).szTab, marrssdInfo2(nCtrlItem).szCond)

			If ReadControlValue(SRCH_CTRL_MATR_AUTOCLOSE) Then
				Dialog Remove
			End If
	End Case

	Exit Sub
'-------------------------
ErrorOccured:
	Note ERR_ERRORMSG & lf & Error$()

End Sub

'**********************************************************************************************''
'Handler - Der blev trykket på 'søg' knappen
'**********************************************************************************************''
Sub HandlerMatr2KnrEnrKenrElavButton

Dim	nCtrl As Integer

OnError GoTo ErrorOccured

	nCtrl		= TriggerControl()
	Call Matr2KnrEnrKenrElavButtonCTRL(nCtrl)

	Exit Sub
'-------------------------
ErrorOccured:
	Note ERR_ERRORMSG & lf & Error$()

End Sub

'**********************************************************************************************''
'Handler - Der blev trykket på 'søg' knappen
'**********************************************************************************************''
Sub Matr2KnrEnrKenrElavButtonCTRL(ByVal nCtrl As Integer)

Dim	nCtrlItem, nLstCtrl As Integer,
	szValue, szLstValue, szCond As String

OnError GoTo ErrorOccured

	nCtrlItem	= (nCtrl - 3) / 100

	Do Case nCtrlItem
		Case 1	'KOMMUNENR
			nLstCtrl	= nCtrl - 3
			szValue	= ReadControlValue(nLstCtrl + 2)
			szCond	= SRCHGetConditionFromValue$(marrssdInfo1(nCtrlItem).szTab, marrssdInfo1(nCtrlItem).szCol, "Like", szValue)

			If SRCHLoadValuesIntoListControl(nLstCtrl, -1, marrssdInfo1(nCtrlItem).szTab, marrssdInfo1(nCtrlItem).szCol, szCond, marrValues1, FALSE) Then
				Call Matr2KnrEnrKenrElavListCTRL(nLstCtrl, FALSE, FALSE)
			End If

		Case 2	'LANDSEJERLAVNR
			nLstCtrl	= nCtrl - 3
			szValue	= ReadControlValue(nLstCtrl + 2)
			szCond	= SRCHGetConditionFromValue$(marrssdInfo1(nCtrlItem).szTab, marrssdInfo1(nCtrlItem).szCol, "Like", szValue)
			szCond 	= SRCHCombineConditions$(marrssdInfo1(1).szCond, szCond)

			If SRCHLoadValuesIntoListControl(nLstCtrl, -1, marrssdInfo1(nCtrlItem).szTab, marrssdInfo1(nCtrlItem).szCol, szCond, marrValues2, FALSE) Then
				Call Matr2KnrEnrElavListCTRL(nLstCtrl, FALSE, FALSE)
			End If

		Case 3	'KOMMEJERLAVNR
			nLstCtrl	= nCtrl - 3
			szValue	= ReadControlValue(nLstCtrl + 2)
			szCond	= SRCHGetConditionFromValue$(marrssdInfo1(nCtrlItem).szTab, marrssdInfo1(nCtrlItem).szCol, "Like", szValue)
			szCond 	= SRCHCombineConditions$(marrssdInfo1(1).szCond, szCond)

			If SRCHLoadValuesIntoListControl(nLstCtrl, -1, marrssdInfo1(nCtrlItem).szTab, marrssdInfo1(nCtrlItem).szCol, szCond, marrValues3, FALSE) Then
				Call Matr2KnrEnrElavListCTRL(nLstCtrl, FALSE, FALSE)
			End If

		Case 4	'LANDSEJERLAVNAVN
			nLstCtrl	= nCtrl - 3
			szValue	= ReadControlValue(nLstCtrl + 2)
			szCond	= SRCHGetConditionFromValue$(marrssdInfo1(nCtrlItem).szTab, marrssdInfo1(nCtrlItem).szCol, "Like", szValue)
			szCond 	= SRCHCombineConditions$(marrssdInfo1(nCtrlItem).szCond, szCond)

			If SRCHLoadValuesIntoListControl(nLstCtrl, -1, marrssdInfo1(nCtrlItem).szTab, marrssdInfo1(nCtrlItem).szCol, szCond, marrValues4, FALSE) Then
				Call Matr2KnrEnrKenrElavListCTRL(nLstCtrl, FALSE, FALSE)
			End If

		Case 5	'MATR.NR.
			nLstCtrl	= nCtrl - 3
			szValue	= ReadControlValue(nLstCtrl + 2)
			szCond	= SRCHGetConditionFromValue$(marrssdInfo2(nCtrlItem).szTab, marrssdInfo2(nCtrlItem).szCol, "Like", szValue)
			szCond 	= SRCHCombineConditions$(marrssdInfo2(2).szCond, szCond)

			If SRCHLoadValuesIntoListControl(nLstCtrl, -1, marrssdInfo2(nCtrlItem).szTab, marrssdInfo2(nCtrlItem).szCol, szCond, marrValues5, FALSE) Then
				Call Matr2KnrEnrKenrElavListCTRL(nLstCtrl, FALSE, FALSE)
			End If
	End Case
	
	Exit Sub
'-------------------------
ErrorOccured:
	Note ERR_ERRORMSG & lf & Error$()

End Sub

'**************************************************************************************************************************''
'   M A T R I K E L O P S L A G :  K O M N R  +  E J E R L A V S N R  +  E J E R L A V  +  M A T R N R
'**************************************************************************************************************************''
'**********************************************************************************************''
' Dialog til opslagssøgning i en enkelte tabel - Knr + Elav & Matrnr
'**********************************************************************************************''
Sub SRCHOpslagMatr2KnrEnrElavMnr(sbtnCur As T_SEARCHBTN)

OnError GoTo ErrorOccured

	'Ejerlavstabel
	marrssdInfo1(1).szTab	= sbtnCur.stabTabs(2).szName
	marrssdInfo1(2).szTab	= sbtnCur.stabTabs(2).szName
	marrssdInfo1(4).szTab	= sbtnCur.stabTabs(2).szName
	marrssdInfo1(1).szCol	= sbtnCur.stabTabs(2).scolCols(1).szName
	marrssdInfo1(2).szCol	= sbtnCur.stabTabs(2).scolCols(2).szName
	marrssdInfo1(4).szCol	= sbtnCur.stabTabs(2).scolCols(3).szName
	marrssdInfo1(1).szDesc	= sbtnCur.stabTabs(2).scolCols(1).szDescription
	marrssdInfo1(2).szDesc	= sbtnCur.stabTabs(2).scolCols(2).szDescription
	marrssdInfo1(4).szDesc	= sbtnCur.stabTabs(2).scolCols(3).szDescription
	'Matrikeltabel
	marrssdInfo2(1).szTab	= sbtnCur.stabTabs(1).szName
	marrssdInfo2(2).szTab	= sbtnCur.stabTabs(1).szName
	marrssdInfo2(5).szTab	= sbtnCur.stabTabs(1).szName
	marrssdInfo2(1).szCol	= sbtnCur.stabTabs(1).scolCols(1).szName
	marrssdInfo2(2).szCol	= sbtnCur.stabTabs(1).scolCols(2).szName
	marrssdInfo2(5).szCol	= sbtnCur.stabTabs(1).scolCols(3).szName
	marrssdInfo2(1).szDesc	= sbtnCur.stabTabs(1).scolCols(1).szDescription
	marrssdInfo2(2).szDesc	= sbtnCur.stabTabs(1).scolCols(2).szDescription
	marrssdInfo2(5).szDesc	= sbtnCur.stabTabs(1).scolCols(3).szDescription

	If sbtnCur.nZoom < 1 Then
		sbtnCur.nZoom = VALUE_DEFAULT_ZOOM
	End If

	Dialog
		Title "Søgning (Jokertegn: % eller _)"
		Calling HandlerMatr2KnrEnrElavLoad
		'----------
		Control StaticText	Position 5,5					ID SRCH_CTRL_MATR_KOMMUNENR_TITLE
			Title marrssdInfo1(1).szDesc
		Control EditText		Position 5,15	Width 35			ID SRCH_CTRL_MATR_KOMMUNENR_VALUE
		Control Button		Position 40,15	Width 15	Height 12	ID SRCH_CTRL_MATR_KOMMUNENR_BUTTON
			Calling HandlerMatr2KnrEnrElavButton
			Title ">>"
		Control ListBox		Position 5,27	Width 50	Height 80	ID SRCH_CTRL_MATR_KOMMUNENR_LIST
			Calling HandlerMatr2KnrEnrElavList
		'----------
		Control StaticText	Position 60,5					ID SRCH_CTRL_MATR_LANDSELAVNR_TITLE
			Title marrssdInfo1(2).szDesc
		Control EditText		Position 60,15	Width 50			ID SRCH_CTRL_MATR_LANDSELAVNR_VALUE
		Control Button		Position 110,15	Width 15	Height 12	ID SRCH_CTRL_MATR_LANDSELAVNR_BUTTON
			Calling HandlerMatr2EnrKenrElavButton
			Title ">>"
		Control ListBox		Position 60,27	Width 65	Height 80	ID SRCH_CTRL_MATR_LANDSELAVNR_LIST
			Calling HandlerMatr2EnrKenrElavList
		'----------
		Control StaticText	Position 130,5					ID SRCH_CTRL_MATR_LANDSELAV_TITLE
			Title marrssdInfo1(4).szDesc
		Control EditText		Position 130,15	Width 110			ID SRCH_CTRL_MATR_LANDSELAV_VALUE
		Control Button		Position 240,15	Width 15	Height 12	ID SRCH_CTRL_MATR_LANDSELAV_BUTTON
			Calling HandlerMatr2KnrEnrElavButton
			Title ">>"
		Control ListBox		Position 130,27	Width 125	Height 80	ID SRCH_CTRL_MATR_LANDSELAV_LIST
			Calling HandlerMatr2KnrEnrElavList
		'----------
		Control StaticText	Position 260,5					ID SRCH_CTRL_MATR_MATRNR_TITLE
			Title marrssdInfo2(5).szDesc
		Control EditText		Position 260,15	Width 35			ID SRCH_CTRL_MATR_MATRNR_VALUE
		Control Button		Position 295,15	Width 15	Height 12	ID SRCH_CTRL_MATR_MATRNR_BUTTON
			Calling HandlerMatr2KnrEnrElavButton
			Title ">>"
		Control ListBox		Position 260,27	Width 50	Height 80	ID SRCH_CTRL_MATR_MATRNR_LIST
			Calling HandlerMatr2KnrEnrElavList

		'----------
		Control StaticText	Position 5,112
			Title "Zoom, m"
		Control EditText		Position 40,110	Width 30			ID SRCH_CTRL_MATR_ZOOM
			Value Str$(sbtnCur.nZoom)
		Control Button		Position 70,110	Width 30	Height 12
			Calling HandlerMatr2OpslagZoom
			Title "Zoom"

		Control CheckBox		Position 105,112					ID SRCH_CTRL_MATR_AUTOCLOSE
			Title "&Auto luk"
			Value SRCHAutoCloseSearchDialog()
			
		Control CancelButton	Position 365,110	Width 40
			Title MSG_CLOSE
					
	Exit Sub
'-------------------------
ErrorOccured:
	Note ERR_ERRORMSG & lf & Error$()

End Sub

'**********************************************************************************************''
'Handler - Loading dialog and setting up controls
'**********************************************************************************************''
Sub HandlerMatr2KnrEnrElavLoad

OnError GoTo ErrorOccured

	Call Matr2KnrEnrElavButtonCTRL(SRCH_CTRL_MATR_KOMMUNENR_BUTTON)

	Exit Sub
'-------------------------
ErrorOccured:
	Note ERR_ERRORMSG & lf & Error$()

End Sub

'**********************************************************************************************''
'Handler - Der blev udpeget en post i en liste
'**********************************************************************************************''
Sub HandlerMatr2KnrEnrElavList

Dim	nCtrl As Integer,
	bSelectAll As Logical

OnError GoTo ErrorOccured

	nCtrl		= TriggerControl()
	bSelectAll	= CommandInfo(CMD_INFO_DLG_DBL)
	
	Call Matr2KnrEnrElavListCTRL(nCtrl, bSelectAll, FALSE)

	Exit Sub
'-------------------------
ErrorOccured:
	Note ERR_ERRORMSG & lf & Error$()

End Sub

'**********************************************************************************************''
'Handler - Der blev udpeget en post i en liste
'**********************************************************************************************''
Sub Matr2KnrEnrElavListCTRL(ByVal nCtrl As Integer, ByVal bSelectAll As Logical, ByVal bReCalled As Logical)

Dim	nCtrlItem, nItem As Integer,
	szValue, szCmdStr As String

OnError GoTo ErrorOccured

	nCtrlItem	= nCtrl / 100
	nItem		= ReadControlValue(nCtrl)

	Do Case nCtrlItem
		Case 1	'KOMMUNENR
			If nItem = 0 Then
				ReDim marrValues2(0)
				ReDim marrValues3(0)
				ReDim marrValues4(0)
			Else
				szValue = marrValues1(nItem)
				marrssdInfo1(nCtrlItem).szCond = SRCHGetConditionFromValue$(marrssdInfo1(nCtrlItem).szTab, marrssdInfo1(nCtrlItem).szCol, "=", szValue)
				marrssdInfo2(nCtrlItem).szCond = SRCHGetConditionFromValue$(marrssdInfo2(nCtrlItem).szTab, marrssdInfo2(nCtrlItem).szCol, "=", szValue)
			End If

			Call Matr2KnrEnrElavButtonCTRL(SRCH_CTRL_MATR_LANDSELAVNR_BUTTON)
			Call Matr2KnrEnrElavButtonCTRL(SRCH_CTRL_MATR_LANDSELAV_BUTTON)

			If bSelectAll Then
				Call HandlerMatr2OpslagZoom
				Call SRCHSelectAll(marrssdInfo2(nCtrlItem).szTab, marrssdInfo2(nCtrlItem).szCond)
			End If

		Case 2	'LANDSEJERLAVNR
			If nItem = 0 Then
				ReDim marrValues5
			Else
				szValue = marrValues2(nItem)
				marrssdInfo1(nCtrlItem).szCond = SRCHGetConditionFromValue$(marrssdInfo1(nCtrlItem).szTab, marrssdInfo1(nCtrlItem).szCol, "=", szValue)
				marrssdInfo2(nCtrlItem).szCond = SRCHGetConditionFromValue$(marrssdInfo2(nCtrlItem).szTab, marrssdInfo2(nCtrlItem).szCol, "=", szValue)
				marrssdInfo1(nCtrlItem).szCond = SRCHCombineConditions$(marrssdInfo1(1).szCond, marrssdInfo1(nCtrlItem).szCond)
				marrssdInfo2(nCtrlItem).szCond = SRCHCombineConditions$(marrssdInfo2(1).szCond, marrssdInfo2(nCtrlItem).szCond)
	
				If NOT bReCalled Then
					'**Finding the matching LANDSEJERLAVNAVN
					If NOT SRCHShowMatchValueInListControl(SRCH_CTRL_MATR_LANDSELAV_LIST, marrssdInfo1(nCtrlItem).szTab,
							marrssdInfo1(nCtrlItem).szCol, marrssdInfo1(4).szCol, marrssdInfo1(nCtrlItem).szCond, marrValues4) Then
					
						Note szValue & ": Tilsvarende " & marrssdInfo1(4).szDesc & " ikke fundet!"
					End If
				End If
			End If

			Call Matr2KnrEnrElavButtonCTRL(SRCH_CTRL_MATR_MATRNR_BUTTON)
		
			If bSelectAll Then
				Call HandlerMatr2OpslagZoom
				Call SRCHSelectAll(marrssdInfo2(nCtrlItem).szTab, marrssdInfo2(nCtrlItem).szCond)
			End If

		Case 4	'LANDSEJERLAVNAVN
			If nItem = 0 Then
				ReDim marrValues5
			Else
				szValue = marrValues4(nItem)
				marrssdInfo1(nCtrlItem).szCond = SRCHGetConditionFromValue$(marrssdInfo1(nCtrlItem).szTab, marrssdInfo1(nCtrlItem).szCol, "=", szValue)
				marrssdInfo1(nCtrlItem).szCond = SRCHCombineConditions$(marrssdInfo1(1).szCond, marrssdInfo1(nCtrlItem).szCond)
	
				'**Finding the matching LANDSEJERLAVNR
				If NOT SRCHShowMatchValueInListControl(SRCH_CTRL_MATR_LANDSELAVNR_LIST, marrssdInfo1(nCtrlItem).szTab,
						marrssdInfo1(nCtrlItem).szCol, marrssdInfo1(2).szCol, marrssdInfo1(nCtrlItem).szCond, marrValues2) Then
				
					Note szValue & ": Tilsvarende " & marrssdInfo1(2).szDesc & " ikke fundet!"
				End If
			End If

			Call Matr2KnrEnrElavListCTRL(SRCH_CTRL_MATR_LANDSELAVNR_LIST, bSelectAll, TRUE)

		Case 5	'MATR.NR.
			If nItem = 0 Then
				Exit Sub
			End If

			szValue = marrValues5(nItem)
			marrssdInfo2(nCtrlItem).szCond = SRCHGetConditionFromValue$(marrssdInfo2(nCtrlItem).szTab, marrssdInfo2(nCtrlItem).szCol, "=", szValue)
			marrssdInfo2(nCtrlItem).szCond = SRCHCombineConditions$(marrssdInfo2(2).szCond, marrssdInfo2(nCtrlItem).szCond)

			Call HandlerMatr2OpslagZoom
			Call SRCHSelectAll(marrssdInfo2(nCtrlItem).szTab, marrssdInfo2(nCtrlItem).szCond)

			If ReadControlValue(SRCH_CTRL_MATR_AUTOCLOSE) Then
				Dialog Remove
			End If
	End Case

	Exit Sub
'-------------------------
ErrorOccured:
	Note ERR_ERRORMSG & lf & Error$()

End Sub

'**********************************************************************************************''
'Handler - Der blev trykket på 'søg' knappen
'**********************************************************************************************''
Sub HandlerMatr2KnrEnrElavButton

Dim	nCtrl As Integer

OnError GoTo ErrorOccured

	nCtrl		= TriggerControl()
	Call Matr2KnrEnrElavButtonCTRL(nCtrl)

	Exit Sub
'-------------------------
ErrorOccured:
	Note ERR_ERRORMSG & lf & Error$()

End Sub

'**********************************************************************************************''
'Handler - Der blev trykket på 'søg' knappen
'**********************************************************************************************''
Sub Matr2KnrEnrElavButtonCTRL(ByVal nCtrl As Integer)

Dim	nCtrlItem, nLstCtrl As Integer,
	szValue, szLstValue, szCond As String

OnError GoTo ErrorOccured

	nCtrlItem	= (nCtrl - 3) / 100

	Do Case nCtrlItem
		Case 1	'KOMMUNENR
			nLstCtrl	= nCtrl - 3
			szValue	= ReadControlValue(nLstCtrl + 2)
			szCond	= SRCHGetConditionFromValue$(marrssdInfo1(nCtrlItem).szTab, marrssdInfo1(nCtrlItem).szCol, "Like", szValue)

			If SRCHLoadValuesIntoListControl(nLstCtrl, -1, marrssdInfo1(nCtrlItem).szTab, marrssdInfo1(nCtrlItem).szCol, szCond, marrValues1, FALSE) Then
				Call Matr2KnrEnrElavListCTRL(nLstCtrl, FALSE, FALSE)
			End If

		Case 2	'LANDSEJERLAVNR
			nLstCtrl	= nCtrl - 3
			szValue	= ReadControlValue(nLstCtrl + 2)
			szCond	= SRCHGetConditionFromValue$(marrssdInfo1(nCtrlItem).szTab, marrssdInfo1(nCtrlItem).szCol, "Like", szValue)
			szCond 	= SRCHCombineConditions$(marrssdInfo1(1).szCond, szCond)

			If SRCHLoadValuesIntoListControl(nLstCtrl, -1, marrssdInfo1(nCtrlItem).szTab, marrssdInfo1(nCtrlItem).szCol, szCond, marrValues2, FALSE) Then
				Call Matr2KnrEnrElavListCTRL(nLstCtrl, FALSE, FALSE)
			End If

		Case 4	'LANDSEJERLAVNAVN
			nLstCtrl	= nCtrl - 3
			szValue	= ReadControlValue(nLstCtrl + 2)
			szCond	= SRCHGetConditionFromValue$(marrssdInfo1(nCtrlItem).szTab, marrssdInfo1(nCtrlItem).szCol, "Like", szValue)
			szCond 	= SRCHCombineConditions$(marrssdInfo1(1).szCond, szCond)

			If SRCHLoadValuesIntoListControl(nLstCtrl, -1, marrssdInfo1(nCtrlItem).szTab, marrssdInfo1(nCtrlItem).szCol, szCond, marrValues4, FALSE) Then
				Call Matr2KnrEnrElavListCTRL(nLstCtrl, FALSE, FALSE)
			End If

		Case 5	'MATR.NR.
			nLstCtrl	= nCtrl - 3
			szValue	= ReadControlValue(nLstCtrl + 2)
			szCond	= SRCHGetConditionFromValue$(marrssdInfo2(nCtrlItem).szTab, marrssdInfo2(nCtrlItem).szCol, "Like", szValue)
			szCond 	= SRCHCombineConditions$(marrssdInfo2(2).szCond, szCond)

			If SRCHLoadValuesIntoListControl(nLstCtrl, -1, marrssdInfo2(nCtrlItem).szTab, marrssdInfo2(nCtrlItem).szCol, szCond, marrValues5, FALSE) Then
				Call Matr2KnrEnrElavListCTRL(nLstCtrl, FALSE, FALSE)
			End If
	End Case
	
	Exit Sub
'-------------------------
ErrorOccured:
	Note ERR_ERRORMSG & lf & Error$()

End Sub


